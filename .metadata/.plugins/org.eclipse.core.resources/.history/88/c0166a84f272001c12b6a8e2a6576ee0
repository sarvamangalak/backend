package com.stock.repository;

import java.time.LocalDate;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.data.mongodb.core.aggregation.Aggregation;
import org.springframework.data.mongodb.core.query.Criteria;
import org.springframework.stereotype.Repository;
import org.springframework.stereotype.Service;

import com.stock.model.Stock;

@Service
public class StockRepos {
	
	@Autowired
	MongoTemplate mongotemplate;
	
	public Stock findByMaxMin(String companyCode,LocalDate from ,LocalDate to)
	{
		Aggregation aggr = Aggregation.newAggregation(Aggregation.match(Criteria.where("companyCode").is(companyCode).and("date").lt(to).gt(from)),Aggregation.group("companyCode").avg("price").as("avg").min("price").as("min").max("price").as("max"));
		return mongotemplate.aggregate(aggr, Stock.class);
		
	}

}
